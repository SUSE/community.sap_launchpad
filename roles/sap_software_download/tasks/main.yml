# SPDX-License-Identifier: Apache-2.0
---

- name: SAP Software Download - Pre-Steps - Include role variables
  ansible.builtin.include_tasks:
    file: pre_steps/01_include_variables.yml

- name: SAP Software Download - Pre-Steps - Prepare Python environment
  ansible.builtin.include_tasks:
    file: pre_steps/02_prepare_python_environment.yml

- name: SAP Software Download - Pre-Steps - Validate user credentials
  ansible.builtin.include_tasks:
    file: pre_steps/03_validate_credentials.yml
  when: not sap_software_download_ignore_validate_credentials | d(false)

- name: SAP Software Download - Pre-Steps - Find files for Maintenance Plan
  ansible.builtin.include_tasks:
    file: pre_steps/04_get_plan_files.yml
  when:
    - sap_software_download_mp_transaction | length > 0

# NOTE: We do not validate files generated by Maintenance Plan.
- name: SAP Software Download - Pre-Steps - Check related SAP Software combinations
  ansible.builtin.include_tasks:
    file: pre_steps/05_validate_relations.yml
  when:
    - sap_software_download_files | length > 0
    - sap_software_download_validate_relationships


- name: SAP Software Download - Download - Stack XML {{ sap_software_download_mp_transaction | d('') }}
  ansible.builtin.include_tasks:
    file: download_stack.yml
  when:
    - sap_software_download_mp_transaction | length > 0
    - sap_software_download_mp_stack_xml | d(true)

- name: SAP Software Download - Download - Maintenance Plan {{ sap_software_download_mp_transaction | d('') }}
  ansible.builtin.include_tasks:
    file: download_plan.yml
  when:
    - sap_software_download_mp_transaction | length > 0
    - __sap_software_download_mp_transaction_results.download_basket is defined
      and __sap_software_download_mp_transaction_results.download_basket | length > 0

- name: SAP Software Download - Download - Files in sap_software_download_files
  ansible.builtin.include_tasks:
    file: download_files.yml


- name: SAP Software Download - Post-Steps - Cleanup Python environment
  ansible.builtin.include_tasks:
    file: post_steps/01_cleanup_python_environment.yml
